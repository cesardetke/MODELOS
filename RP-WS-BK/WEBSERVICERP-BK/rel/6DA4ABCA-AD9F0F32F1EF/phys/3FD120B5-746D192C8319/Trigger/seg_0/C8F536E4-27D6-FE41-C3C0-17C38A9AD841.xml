<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="T_RP_MOD_NOVEDAD_5" directorySegmentName="seg_0" id="C8F536E4-27D6-FE41-C3C0-17C38A9AD841">
<sourceConnName>PROD</sourceConnName>
<sourceObjSchema>RAPIPAGO</sourceObjSchema>
<sourceObjName>T_RP_MOD_NOVEDAD_5</sourceObjName>
<createdBy>CDETKE</createdBy>
<createdTime>2022-01-04 18:03:25 UTC</createdTime>
<ownerDesignName>WEBSERVICERP-BK</ownerDesignName>
<actions>UPDATE</actions>
<body><![CDATA[DECLARE
   wNumerador  NUMBER;
   v_accion VARCHAR2(1);
   v_VISIBLE VARCHAR2(1);
BEGIN
    IF NVL(:OLD.IS_DELETED,0) != NVL(:NEW.IS_DELETED,0) THEN
       IF :NEW.IS_DELETED = 'Y' AND :OLD.ESTADO = 'H' AND :OLD.VISIBLE = 'Y' THEN
          v_accion := 'B';
       END IF;
       
       IF :NEW.IS_DELETED = 'N' AND :OLD.ESTADO = 'H' AND :OLD.VISIBLE = 'Y' THEN       
          v_accion := 'A';
       END IF;

       IF v_accion IS NOT NULL THEN       
           SELECT RAPIPAGO.RP_SQ_NOVEDAD_COBERTURA.NEXTVAL into wNUMERADOR FROM DUAL;  
           
           INSERT INTO RAPIPAGO.WS_COBERTURA_NOVEDADES
              (ID_NOVEDAD, ID_GRUPO, TABLA, ID_TABLA, ESTADO, ACCION, CAMPO, VALOR_ANT, VALOR_NVO)
           VALUES(wNumerador, 'EMPRESA', 'RP_EMPR_PUESTO_MODALIDAD', :OLD.ID_EMPR_PUESTO_MODALIDAD,'P',v_accion, 'IS_DELETED', :OLD.IS_DELETED, :NEW.IS_DELETED);
       END IF;
    END IF;
    
       
    IF NVL(:OLD.ESTADO,0) != NVL(:NEW.ESTADO,0) THEN
       IF :NEW.ESTADO != 'H' AND :OLD.ESTADO = 'H' AND :OLD.IS_DELETED = 'N' AND :OLD.VISIBLE = 'Y' THEN
           v_accion := 'B';
       END IF;
       
       IF :NEW.ESTADO = 'H' AND :OLD.IS_DELETED = 'N' AND :OLD.VISIBLE = 'Y' THEN
          v_accion := 'A';
       END IF;
        
       IF v_accion IS NOT NULL THEN
            SELECT RAPIPAGO.RP_SQ_NOVEDAD_COBERTURA.NEXTVAL into wNUMERADOR FROM DUAL;  
       
            INSERT INTO RAPIPAGO.WS_COBERTURA_NOVEDADES
                (ID_NOVEDAD, ID_GRUPO, TABLA, ID_TABLA, ESTADO, ACCION, CAMPO, VALOR_ANT, VALOR_NVO)
            VALUES(wNumerador, 'EMPRESA', 'RP_EMPR_PUESTO_MODALIDAD', :OLD.ID_EMPR_PUESTO_MODALIDAD,'P',v_accion, 'ESTADO', :OLD.ESTADO, :NEW.ESTADO);
       END IF;
    END IF;
    
    IF NVL(:OLD.VISIBLE,0) != NVL(:NEW.VISIBLE,0) THEN
       IF :NEW.VISIBLE != 'Y' AND :OLD.ESTADO = 'H' AND :OLD.IS_DELETED = 'N' THEN
          v_accion := 'B';
       END IF;
       
       IF :NEW.VISIBLE = 'Y' AND :OLD.ESTADO = 'H' AND :OLD.IS_DELETED = 'N' THEN
          v_accion := 'A';
       END IF;

       IF v_accion IS NOT NULL THEN
            SELECT RAPIPAGO.RP_SQ_NOVEDAD_COBERTURA.NEXTVAL into wNUMERADOR FROM DUAL;  
            
            INSERT INTO RAPIPAGO.WS_COBERTURA_NOVEDADES
                (ID_NOVEDAD, ID_GRUPO, TABLA, ID_TABLA, ESTADO, ACCION, CAMPO, VALOR_ANT, VALOR_NVO)
            VALUES(wNumerador, 'EMPRESA', 'RP_EMPR_PUESTO_MODALIDAD', :OLD.ID_EMPR_PUESTO_MODALIDAD,'P',v_accion, 'VISIBLE', :OLD.VISIBLE, :NEW.VISIBLE);
       END IF;
    END IF;    


    IF NVL(:OLD.ACREDITACION_BILLETERA,0) != NVL(:NEW.ACREDITACION_BILLETERA,0) THEN
       BEGIN
            SELECT VISIBLE
            INTO v_VISIBLE
            FROM RAPIPAGO.RP_EMPR_PUESTO_MODALIDAD
            WHERE ID_EMPR_PUESTO_MODALIDAD = :OLD.ID_EMPR_PUESTO_MODALIDAD;
       END;
       
       IF :NEW.ACREDITACION_BILLETERA = 'Y'  AND :OLD.VISIBLE = 'Y' AND :OLD.ESTADO = 'H' AND :OLD.IS_DELETED = 'N' THEN
          v_accion := 'A';
       ELSE
            IF v_VISIBLE = 'Y' AND :OLD.ESTADO = 'H' AND :OLD.IS_DELETED = 'N' THEN
               v_accion := 'A';
            ELSE
               v_accion := 'B';
            END IF;
       END IF;

       IF v_accion IS NOT NULL THEN
           SELECT RAPIPAGO.RP_SQ_NOVEDAD_COBERTURA.NEXTVAL into wNUMERADOR FROM DUAL;  
           
           INSERT INTO RAPIPAGO.WS_COBERTURA_NOVEDADES
              (ID_NOVEDAD, ID_GRUPO, TABLA, ID_TABLA, ESTADO, ACCION, CAMPO, VALOR_ANT, VALOR_NVO)
           VALUES(wNumerador, 'EMPRESA', 'RP_EMPR_PUESTO_MODALIDAD', :OLD.ID_EMPR_PUESTO_MODALIDAD,'P',v_accion, 'ACREDITACION_BILLETERA', :OLD.ACREDITACION_BILLETERA, :NEW.ACREDITACION_BILLETERA);
       END IF;
    END IF;        

END;]]></body>
<triggerTime>AFTER</triggerTime>
<owner>C62C8F1E-2A53-0B75-10F9-F26CB65E46CC</owner>
<table>4992F1D8-0AAF-2718-6F21-85E45CC60D49</table>
</TriggerOraclev10g>