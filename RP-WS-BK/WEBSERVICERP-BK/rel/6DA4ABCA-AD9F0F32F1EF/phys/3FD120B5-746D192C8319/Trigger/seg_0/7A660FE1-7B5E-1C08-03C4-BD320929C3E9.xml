<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="DESHABILITAR_SUC_RAPIENTREGA" directorySegmentName="seg_0" id="7A660FE1-7B5E-1C08-03C4-BD320929C3E9">
<sourceConnName>PROD</sourceConnName>
<sourceObjSchema>RAPIPAGO</sourceObjSchema>
<sourceObjName>DESHABILITAR_SUC_RAPIENTREGA</sourceObjName>
<createdBy>CDETKE</createdBy>
<createdTime>2022-01-04 18:03:24 UTC</createdTime>
<ownerDesignName>WEBSERVICERP-BK</ownerDesignName>
<actions>UPDATE</actions>
<body><![CDATA[DECLARE
   codigoSucursalChar varchar(8);
   fechaHoyChar varchar(20);
BEGIN
    --si la sucursal de rapientrega es eliminada
    IF (:VIEJO.ENTREGA_ELEMENTOS = 'Y' AND ((:VIEJO.IS_DELETED = 'N' AND :NUEVO.IS_DELETED = 'Y') OR
        (:VIEJO.WF_STATUS != 'ELI' AND :NUEVO.WF_STATUS = 'ELI'))) THEN  
        codigoSucursalChar := TO_CHAR(:VIEJO.COD_SUCURSAL);
        --convierto SYSDATE a char y luego lo convierto con "TO_DATE" porque el dblink a SQL no acepta directamente a "SYSDATE" en su sentencia
        fechaHoyChar := TO_CHAR(SYSDATE, 'YYYYMMDD HH24:MI:SS');
                
        UPDATE sucursal@LINK_DBSIRP_SQL S SET
            S."habilitada" = 0,
            S."fecha_mod" = TO_DATE(fechaHoyChar, 'YYYYMMDD HH24:MI:SS'),
            S."usuario_mod" = 'interface Rapipago'
        WHERE S."numero_sucursal" = codigoSucursalChar AND S."habilitada" = 1 AND S."fecha_baja" IS NULL;
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        GIRE.PKG_CORREOS.ENVIO_CORREO('cristian.balaguer@gire.com', 'ERROR - PROCESO BAJA AUTOMÃTICA SUCURSALES', SQLERRM, 'RAPIENTREGA');
END;]]></body>
<triggerTime>BEFORE</triggerTime>
<owner>C62C8F1E-2A53-0B75-10F9-F26CB65E46CC</owner>
<ref_NEW_AS>NUEVO</ref_NEW_AS>
<ref_OLD_AS>VIEJO</ref_OLD_AS>
<table>80B68678-7C49-E212-35AF-0A3E3BDDD305</table>
</TriggerOraclev10g>