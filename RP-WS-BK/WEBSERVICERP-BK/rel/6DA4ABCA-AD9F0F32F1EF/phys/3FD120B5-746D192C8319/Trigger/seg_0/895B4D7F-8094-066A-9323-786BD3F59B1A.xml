<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="T_RP2_AGENTE_SUCURSAL" directorySegmentName="seg_0" id="895B4D7F-8094-066A-9323-786BD3F59B1A">
<sourceConnName>PROD</sourceConnName>
<sourceObjSchema>RAPIPAGO</sourceObjSchema>
<sourceObjName>T_RP2_AGENTE_SUCURSAL</sourceObjName>
<createdBy>CDETKE</createdBy>
<createdTime>2022-01-04 18:03:24 UTC</createdTime>
<ownerDesignName>WEBSERVICERP-BK</ownerDesignName>
<actions>UPDATE</actions>
<body><![CDATA[DECLARE
lintSOPORTE_TECNICO   NUMBER(3);

BEGIN

    SELECT  CODIGO_SOPORTE_TECNICO
    INTO    lintSOPORTE_TECNICO
    FROM    RAPIPAGO.RP_SOPORTE_TECNICO
    WHERE   ID_SOPORTE_TECNICO = :NEW.ID_SOPORTE_TECNICO;
    

   IF :NEW.COD_SUCURSAL IS NOT NULL AND :OLD.COD_SUCURSAL IS NULL THEN
       /*
       INSERT INTO RAPI2.SUCURSALES@LINK_OL (
            SUCURSAL, AGENTE, LOCALIDAD, PROVINCIA, DESCRIPCION, NOMBRE_COMERCIAL, FECHA_PRIMERA_ACTIVIDAD,
            DOMICILIO, CODIGO_POSTAL, TRABAJA_HABILES, TRABAJA_SABADO, TRABAJA_DOMINGO, TRABAJA_FERIADO,
            ZONA_ESTADISTICA, ZONA_FACTURACION, ZONA_COMISION, SOPORTE_TECNICO, PRIORIDAD_ASIGNACION_PINES,
            NRO_FAX, SIN_FACTURA, RETIRA_FONDOS, CONTACTO, TELEFONOS, USUARIO, FH_ACTUALIZACION    
        ) VALUES (
            :NEW.COD_SUCURSAL,
            (SELECT COD_AGENTE FROM RAPIPAGO.RP_AGENTE   
                    WHERE ID_AGENTE = :NEW.ID_AGENTE AND IS_DELETED='N'),
            (SELECT SUBSTR(DESCRIPCION,1,30) FROM RAPIPAGO.RP_PROV_PARTIDO_LOCALIDAD 
                    WHERE ID_PROV_PARTIDO_LOCALIDAD = :NEW.ID_PROV_PARTIDO_LOCALIDAD
                    AND   IS_DELETED='N'),
            (SELECT COD_PROVINCIA FROM RAPIPAGO.RP_PROVINCIA 
                    WHERE ID_PROVINCIA = :NEW.ID_PROVINCIA AND IS_DELETED='N'),
            SUBSTR(:NEW.NOMBRE,1,40),
            SUBSTR(:NEW.NOMBRE,1,40),
             TO_DATE('31/12/2999','DD/MM/YYYY'),
            :NEW.CALLE||' '||:NEW.NUMERO,
            :NEW.CODIGO_POSTAL,
            DECODE(:NEW.TRABAJA_HABILES,'Y','S','N'),
            DECODE(:NEW.TRABAJA_SABADO,'Y','S','N'),
            DECODE(:NEW.TRABAJA_DOMINGO,'Y','S','N'),
            DECODE(:NEW.TRABAJA_FERIADO,'Y','S','N'),
            1,
            1,
            1,
            lintSOPORTE_TECNICO,
            0,
            '-',
            'S',
            'N',
            (SELECT SUBSTR(NOMBRE_APELLIDO,1,60) FROM RAPIPAGO.RP_AGENTE_SUCURSAL_CONTACTO 
                    WHERE ID_AGENTE_SUCURSAL=:NEW.ID_AGENTE_SUCURSAL AND IS_DELETED='N' AND ROWNUM=1),
            (SELECT SUBSTR(TELEFONO,1,40)    FROM RAPIPAGO.RP_AGENTE_SUCURSAL_CONTACTO  
                    WHERE ID_AGENTE_SUCURSAL=:NEW.ID_AGENTE_SUCURSAL AND IS_DELETED='N' AND ROWNUM=1),
            USER,
            SYSDATE
       );

       */
        null;
   ELSE
        IF :NEW.NOMBRE <> :OLD.NOMBRE THEN 
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                DESCRIPCION       = SUBSTR(:NEW.NOMBRE,1,40),
                NOMBRE_COMERCIAL  = SUBSTR(:NEW.NOMBRE,1,40)    
            WHERE SUCURSAL = :NEW.COD_SUCURSAL;     
        END IF;
        
        IF :NEW.TRABAJA_HABILES <> :OLD.TRABAJA_HABILES THEN 
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                TRABAJA_HABILES   = DECODE(:NEW.TRABAJA_HABILES,'Y','S','N')
            WHERE SUCURSAL = :NEW.COD_SUCURSAL;     
        END IF;
        
        IF :NEW.TRABAJA_SABADO <> :OLD.TRABAJA_SABADO THEN 
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                TRABAJA_SABADO   = DECODE(:NEW.TRABAJA_SABADO,'Y','S','N')
            WHERE SUCURSAL = :NEW.COD_SUCURSAL;     
        END IF;
        
        IF :NEW.TRABAJA_DOMINGO <> :OLD.TRABAJA_DOMINGO THEN 
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                TRABAJA_DOMINGO   = DECODE(:NEW.TRABAJA_DOMINGO,'Y','S','N')
            WHERE SUCURSAL = :NEW.COD_SUCURSAL;     
        END IF;
        
        IF :NEW.TRABAJA_FERIADO <> :OLD.TRABAJA_FERIADO THEN 
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                TRABAJA_FERIADO   = DECODE(:NEW.TRABAJA_FERIADO,'Y','S','N')
            WHERE SUCURSAL = :NEW.COD_SUCURSAL;     
        END IF;
                
        IF :NEW.TELEFONO <> :OLD.TELEFONO THEN 
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                TELEFONOS = SUBSTR(:NEW.TELEFONO,1,40)
            WHERE SUCURSAL = :NEW.COD_SUCURSAL;     
        END IF;

        UPDATE RAPI2.SUCURSALES@LINK_OL SET
            SOPORTE_TECNICO = lintSOPORTE_TECNICO
        WHERE SUCURSAL = :NEW.COD_SUCURSAL;
        
        IF :NEW.WF_STATUS = 'ELI' AND :OLD.WF_STATUS <> 'ELI' THEN
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                FECHA_BAJA = TRUNC(SYSDATE)
            WHERE   SUCURSAL = :NEW.COD_SUCURSAL
            AND     FECHA_BAJA IS NULL;
        END IF;
        
        IF :NEW.WF_STATUS <> 'ELI' AND :OLD.WF_STATUS = 'ELI' THEN
            UPDATE RAPI2.SUCURSALES@LINK_OL SET
                FECHA_BAJA = NULL
            WHERE   SUCURSAL = :NEW.COD_SUCURSAL
            AND     FECHA_BAJA IS NOT NULL;
        END IF;

   END IF;

EXCEPTION
     WHEN OTHERS THEN
       -- 
       RAISE ;
END ;]]></body>
<triggerTime>BEFORE</triggerTime>
<owner>C62C8F1E-2A53-0B75-10F9-F26CB65E46CC</owner>
<table>80B68678-7C49-E212-35AF-0A3E3BDDD305</table>
</TriggerOraclev10g>