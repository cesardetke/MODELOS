<?xml version = '1.0' encoding = 'UTF-8'?>
<TriggerOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.TriggerOraclev10g" name="TRG_COBERTURA_X_DELTA" directorySegmentName="seg_0" id="F5FE53FF-3CEB-915B-912A-D62E6C275240">
<sourceConnName>PROD</sourceConnName>
<sourceObjSchema>RAPIPAGO</sourceObjSchema>
<sourceObjName>TRG_COBERTURA_X_DELTA</sourceObjName>
<createdBy>CDETKE</createdBy>
<createdTime>2022-01-04 18:03:26 UTC</createdTime>
<ownerDesignName>WEBSERVICERP-BK</ownerDesignName>
<actions>INSERT, UPDATE</actions>
<body><![CDATA[DECLARE
v_VERSION VARCHAR2(6) := NULL;
v_CONTROL NUMBER :=0;

BEGIN
  IF (UPDATING) THEN
        :new.AUD_DATE_UPDATE := SYSDATE ;
        :new.AUD_USER_UPDATE := UPPER(substr(user, 1, 30)) ;
  END IF ;
  
  IF INSERTING then
        BEGIN
            SELECT VERSION_RAPIPAGO
            INTO v_VERSION
            FROM RAPIPAGO.RP_PUESTO P,
                RAPIPAGO.RP_VARIABLES_COBERTURA V
            WHERE P.ID_AGENTE_SUCURSAL = :new.ID_AGENTE_SUCURSAL
            AND INSTR(V.VALOR, TRIM(P.VERSION_RAPIPAGO)) > 0 AND V.PALABRA_CLAVE = 'VERSION_RAPIPAGO'
            AND P.IS_DELETED = 'N' AND P.WF_STATUS = 'HAB'
            AND ROWNUM = 1;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                 v_VERSION := 'N/A';
        END;

       :new.AUD_DATE_INSERT  := SYSDATE ; 
       :new.AUD_USER_INSERT  := UPPER(substr(user, 1, 30)) ;
       :new.VERSION_RP := TRIM(v_VERSION);
  END IF ;
  
EXCEPTION
     WHEN OTHERS THEN
       -- 
       RAISE ;
END;]]></body>
<triggerTime>BEFORE</triggerTime>
<owner>C62C8F1E-2A53-0B75-10F9-F26CB65E46CC</owner>
<table>DCCCD8F0-90FD-397A-2D95-A2036BC1BE7A</table>
</TriggerOraclev10g>